!function(){"use strict";var e=window.jQuery,r="abcdefgh".split(""),t="1.8.3",a="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",n=m(a),o={};function s(e,r,t){var a=0,n=!1,o=[],s=function(){a=0,n&&(n=!1,i())},i=function(){a=window.setTimeout(s,r),e.apply(t,o)};return function(e){o=arguments,a?n=!0:i()}}function i(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)})}function p(e){return JSON.parse(JSON.stringify(e))}function c(e){var r=e.split(".");return{major:parseInt(r[0],10),minor:parseInt(r[1],10),patch:parseInt(r[2],10)}}function u(e,r){for(var t in r)if(r.hasOwnProperty(t))for(var a="{"+t+"}",n=r[t];-1!==e.indexOf(a);)e=e.replace(a,n);return e}function f(e){return"string"==typeof e}function d(e){return"function"==typeof e}function h(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function l(e){return"fast"===e||"slow"===e||!!h(e)&&e>=0}function _(e){if(!f(e))return!1;var r=e.split("-");return 2===r.length&&v(r[0])&&v(r[1])}function v(e){return f(e)&&-1!==e.search(/^[a-h][1-8]$/)}function g(e){return f(e)&&-1!==e.search(/^[bw][KQRNBP]$/)}function P(e){if(!f(e))return!1;var r,t=(e=(r=e=e.replace(/ .+$/,""),r.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11"))).split("/");if(8!==t.length)return!1;for(var a=0;a<8;a++)if(8!==t[a].length||-1!==t[a].search(/[^kqrnbpKQRNBP1]/))return!1;return!0}function b(r){if(!e.isPlainObject(r))return!1;for(var t in r)if(r.hasOwnProperty(t)&&(!v(t)||!g(r[t])))return!1;return!0}function $(e){return e.toLowerCase()===e?"b"+e.toUpperCase():"w"+e.toUpperCase()}function w(e){var r=e.split("");return"w"===r[0]?r[1].toUpperCase():r[1].toLowerCase()}function m(e){if(!P(e))return!1;for(var t=(e=e.replace(/ .+$/,"")).split("/"),a={},n=8,o=0;o<8;o++){for(var s=t[o].split(""),i=0,p=0;p<s.length;p++)-1!==s[p].search(/[1-8]/)?i+=parseInt(s[p],10):(a[r[i]+n]=$(s[p]),i+=1);n-=1}return a}function y(e){if(!b(e))return!1;for(var t,a="",n=8,o=0;o<8;o++){for(var s=0;s<8;s++){var i=r[s]+n;e.hasOwnProperty(i)?a+=w(e[i]):a+="1"}7!==o&&(a+="/"),n-=1}return t=a,t.replace(/11111111/g,"8").replace(/1111111/g,"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}function x(e,t){var a=e.split(""),n=r.indexOf(a[0])+1,o=parseInt(a[1],10),s=t.split(""),i=r.indexOf(s[0])+1,p=parseInt(s[1],10),c=Math.abs(n-i),u=Math.abs(o-p);return c>=u?c:u}function O(e,t,a){for(var n=function e(t){for(var a=[],n=0;n<8;n++)for(var o=0;o<8;o++){var s=r[n]+(o+1);t!==s&&a.push({square:s,distance:x(t,s)})}a.sort(function(e,r){return e.distance-r.distance});var i=[];for(n=0;n<a.length;n++)i.push(a[n].square);return i}(a),o=0;o<n.length;o++){var s=n[o];if(e.hasOwnProperty(s)&&e[s]===t)return s}return!1}o.alpha="alpha-d2270",o.black="black-3c85d",o.board="board-b72b1",o.chessboard="chessboard-63f37",o.clearfix="clearfix-7da63",o.highlight1="highlight1-32417",o.highlight2="highlight2-9c5d2",o.notation="notation-322f9",o.numeric="numeric-fc462",o.piece="piece-417db",o.row="row-5277c",o.sparePieces="spare-pieces-7492f",o.sparePiecesBottom="spare-pieces-bottom-ae20f",o.sparePiecesTop="spare-pieces-top-4028b",o.square="square-55d63",o.white="white-1e1d7",console.assert("abc"===u("abc",{a:"x"})),console.assert("{a}bc"===u("{a}bc",{})),console.assert("{a}bc"===u("{a}bc",{p:"q"})),console.assert("xbc"===u("{a}bc",{a:"x"})),console.assert("xbcxbc"===u("{a}bc{a}bc",{a:"x"})),console.assert("xxy"===u("{a}{a}{b}",{a:"x",b:"y"})),console.assert(v("a1")),console.assert(v("e2")),console.assert(!v("D2")),console.assert(!v("g9")),console.assert(!v("a")),console.assert(!v(!0)),console.assert(!v(null)),console.assert(!v({})),console.assert(g("bP")),console.assert(g("bK")),console.assert(g("wK")),console.assert(g("wR")),console.assert(!g("WR")),console.assert(!g("Wr")),console.assert(!g("a")),console.assert(!g(!0)),console.assert(!g(null)),console.assert(!g({})),console.assert(P(a)),console.assert(P("8/8/8/8/8/8/8/8")),console.assert(P("r1bqkbnr/pppp1ppp/2n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R")),console.assert(P("3r3r/1p4pp/2nb1k2/pP3p2/8/PB2PN2/p4PPP/R4RK1 b - - 0 1")),console.assert(!P("3r3z/1p4pp/2nb1k2/pP3p2/8/PB2PN2/p4PPP/R4RK1 b - - 0 1")),console.assert(!P("anbqkbnr/8/8/8/8/8/PPPPPPPP/8")),console.assert(!P("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/")),console.assert(!P("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBN")),console.assert(!P("888888/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR")),console.assert(!P("888888/pppppppp/74/8/8/8/PPPPPPPP/RNBQKBNR")),console.assert(!P({})),console.assert(b(n)),console.assert(b({})),console.assert(b({e2:"wP"})),console.assert(b({e2:"wP",d2:"wP"})),console.assert(!b({e2:"BP"})),console.assert(!b({y2:"wP"})),console.assert(!b(null)),console.assert(!b("start")),console.assert(!b(a)),console.assert(y(n)===a),console.assert("8/8/8/8/8/8/8/8"===y({})),console.assert("8/8/8/8/8/8/Pp6/8"===y({a2:"wP",b2:"bP"})),window.Chessboard=function a(g,$){if(window.$,(!e.fn||!e.fn.jquery||(q=e.fn.jquery,k=t,q=c(q),k=c(k),!((T=1e10*q.major+1e5*q.minor+q.patch)>=1e10*k.major+1e5*k.minor+k.patch)))&&(window.alert("Chessboard Error 1005: Unable to find a valid version of jQuery. Please include jQuery "+t+" or higher on the page\n\nExiting…"),1))return null;var w,x,q,k,T,S,B,C,E,R,N=function r(t){if(""===t)return window.alert("Chessboard Error 1001: The first argument to Chessboard() cannot be an empty string.\n\nExiting…"),!1;f(t)&&"#"!==t.charAt(0)&&(t="#"+t);var a=e(t);return 1!==a.length?(window.alert("Chessboard Error 1003: The first argument to Chessboard() must be the ID of a DOM node, an ID query selector, or a single DOM node.\n\nExiting…"),!1):a}(g);if(!N)return null;$=(w=$=("start"===(S=$)?S={position:p(n)}:P(S)?S={position:m(S)}:b(S)&&(S={position:p(S)}),e.isPlainObject(S)||(S={}),S),"black"!==w.orientation&&(w.orientation="white"),!1!==w.showNotation&&(w.showNotation=!0),!0!==w.draggable&&(w.draggable=!1),"trash"!==w.dropOffBoard&&(w.dropOffBoard="snapback"),!0!==w.sparePieces&&(w.sparePieces=!1),w.sparePieces&&(w.draggable=!0),w.hasOwnProperty("pieceTheme")&&(f(w.pieceTheme)||d(w.pieceTheme))||(w.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),l(w.appearSpeed)||(w.appearSpeed=200),l(w.moveSpeed)||(w.moveSpeed=200),l(w.snapbackSpeed)||(w.snapbackSpeed=60),l(w.snapSpeed)||(w.snapSpeed=30),l(w.trashSpeed)||(w.trashSpeed=100),(!h(x=w.dragThrottleRate)||!(x>=1))&&(w.dragThrottleRate=20),w);var K=null,j=null,D=null,Q=null,M={},X=2,Y="white",I={},L=null,U=null,z=null,W=!1,A={},F={},G={},H=16;function J(e,r,t){if(!0===$.hasOwnProperty("showErrors")&&!1!==$.showErrors){var a="Chessboard Error "+e+": "+r;if("console"===$.showErrors&&"object"==typeof console&&"function"==typeof console.log){console.log(a),arguments.length>=2&&console.log(t);return}if("alert"===$.showErrors){t&&(a+="\n\n"+JSON.stringify(t)),window.alert(a);return}d($.showErrors)&&$.showErrors(e,r,t)}}function V(e){return d($.pieceTheme)?$.pieceTheme(e):f($.pieceTheme)?u($.pieceTheme,{piece:e}):(J(8272,"Unable to build image source for config.pieceTheme."),"")}function Z(e,r,t){var a='<img src="'+V(e)+'" ';return f(t)&&""!==t&&(a+='id="'+t+'" '),a+='alt="" class="{piece}" data-piece="'+e+'" style="width:'+H+"px;height:"+H+"px;",r&&(a+="display:none;"),u(a+='" />',o)}function ee(e){var r=["wK","wQ","wR","wB","wN","wP"];"black"===e&&(r=["bK","bQ","bR","bB","bN","bP"]);for(var t="",a=0;a<r.length;a++)t+=Z(r[a],!1,A[r[a]]);return t}function er(r,t,a,n){var s=e("#"+F[r]),p=s.offset(),c=e("#"+F[t]),u=c.offset(),f=i();e("body").append(Z(a,!0,f));var h=e("#"+f);h.css({display:"",position:"absolute",top:p.top,left:p.left}),s.find("."+o.piece).remove();var l={duration:$.moveSpeed,complete:function e(){c.append(Z(a)),h.remove(),d(n)&&n()}};h.animate(u,l)}function et(r,t,a){var n=e("#"+A[r]).offset(),s=e("#"+F[t]),p=s.offset(),c=i();e("body").append(Z(r,!0,c));var u=e("#"+c);u.css({display:"",position:"absolute",left:n.left,top:n.top});var f={duration:$.moveSpeed,complete:function e(){s.find("."+o.piece).remove(),s.append(Z(r)),u.remove(),d(a)&&a()}};u.animate(p,f)}function ea(){for(var r in K.find("."+o.piece).remove(),I)I.hasOwnProperty(r)&&e("#"+F[r]).append(Z(I[r]))}function en(){K.html(function e(t){"black"!==t&&(t="white");var a="",n=p(r),s=8;"black"===t&&(n.reverse(),s=1);for(var i="white",c=0;c<8;c++){a+='<div class="{row}">';for(var f=0;f<8;f++){var d=n[f]+s;a+='<div class="{square} '+o[i]+" square-"+d+'" style="width:'+H+"px;height:"+H+'px;" id="'+F[d]+'" data-square="'+d+'">',$.showNotation&&(("white"===t&&1===s||"black"===t&&8===s)&&(a+='<div class="{notation} {alpha}">'+n[f]+"</div>"),0===f&&(a+='<div class="{notation} {numeric}">'+s+"</div>")),a+="</div>",i="white"===i?"black":"white"}a+='<div class="{clearfix}"></div></div>',i="white"===i?"black":"white","white"===t?s-=1:s+=1}return u(a,o)}(Y,H,$.showNotation)),ea(),$.sparePieces&&("white"===Y?(D.html(ee("black")),Q.html(ee("white"))):(D.html(ee("white")),Q.html(ee("black"))))}function eo(e){var r=p(I),t=p(e),a=y(r),n=y(t);a!==n&&(d($.onChange)&&$.onChange(r,t),I=e)}function es(e,r){for(var t in G)if(G.hasOwnProperty(t)){var a=G[t];if(e>=a.left&&e<a.left+H&&r>=a.top&&r<a.top+H)return t}return"offboard"}function ei(){K.find("."+o.square).removeClass(o.highlight1+" "+o.highlight2)}function ep(){ei();var e=p(I);delete e[z],eo(e),ea(),j.fadeOut($.trashSpeed),W=!1}function ec(r,t,a,n){(!d($.onDragStart)||!1!==$.onDragStart(r,t,p(I),Y))&&(W=!0,L=t,z=r,U="spare"===r?"offboard":r,function r(){for(var t in G={},F)F.hasOwnProperty(t)&&(G[t]=e("#"+F[t]).offset())}(),j.attr("src",V(t)).css({display:"",position:"absolute",left:a-H/2,top:n-H/2}),"spare"!==r&&e("#"+F[r]).addClass(o.highlight1).find("."+o.piece).css("display","none"))}function eu(r,t){j.css({left:r-H/2,top:t-H/2});var a=es(r,t);a!==U&&(v(U)&&e("#"+F[U]).removeClass(o.highlight2),v(a)&&e("#"+F[a]).addClass(o.highlight2),d($.onDragMove)&&$.onDragMove(a,U,z,L,p(I),Y),U=a)}function ef(r){var t,a,n,o,s="drop";if("offboard"===r&&"snapback"===$.dropOffBoard&&(s="snapback"),"offboard"===r&&"trash"===$.dropOffBoard&&(s="trash"),d($.onDrop)){var i=p(I);"spare"===z&&v(r)&&(i[r]=L),v(z)&&"offboard"===r&&delete i[z],v(z)&&v(r)&&(delete i[z],i[r]=L);var c=p(I),u=$.onDrop(z,r,L,i,c,Y);("snapback"===u||"trash"===u)&&(s=u)}"snapback"===s?!function r(){if("spare"===z){ep();return}ei();var t=e("#"+F[z]).offset(),a={duration:$.snapbackSpeed,complete:function e(){ea(),j.css("display","none"),d($.onSnapbackEnd)&&$.onSnapbackEnd(L,z,p(I),Y)}};j.animate(t,a),W=!1}():"trash"===s?ep():"drop"===s&&(t=r,ei(),delete(a=p(I))[z],a[t]=L,eo(a),n=e("#"+F[t]).offset(),o={duration:$.snapSpeed,complete:function e(){ea(),j.css("display","none"),d($.onSnapEnd)&&$.onSnapEnd(z,t,L)}},j.animate(n,o),W=!1)}M.clear=function(e){M.position({},e)},M.destroy=function(){N.html(""),j.remove(),N.unbind()},M.fen=function(){return M.position("fen")},M.flip=function(){return M.orientation("flip")},M.move=function(){if(0!==arguments.length){for(var e=!0,r={},t=0;t<arguments.length;t++){if(!1===arguments[t]){e=!1;continue}if(!_(arguments[t])){J(2826,"Invalid move passed to the move method.",arguments[t]);continue}var a=arguments[t].split("-");r[a[0]]=a[1]}var n=function e(r,t){var a=p(r);for(var n in t)if(t.hasOwnProperty(n)&&a.hasOwnProperty(n)){var o=a[n];delete a[n],a[t[n]]=o}return a}(I,r);return M.position(n,e),n}},M.orientation=function(e){return 0===arguments.length?Y:"white"===e||"black"===e?(Y=e,en(),Y):"flip"===e?(Y="white"===Y?"black":"white",en(),Y):void J(5482,"Invalid value passed to the orientation method.",e)},M.position=function(r,t){if(0===arguments.length)return p(I);if(f(r)&&"fen"===r.toLowerCase())return y(I);if(f(r)&&"start"===r.toLowerCase()&&(r=p(n)),P(r)&&(r=m(r)),!b(r)){J(6482,"Invalid value passed to the position method.",r);return}(!1!==t&&(t=!0),t)?(function r(t,a,n){if(0!==t.length)for(var s=0,i=0;i<t.length;i++){var c=t[i];"clear"===c.type?e("#"+F[c.square]+" ."+o.piece).fadeOut($.trashSpeed,u):"add"!==c.type||$.sparePieces?"add"===c.type&&$.sparePieces?et(c.piece,c.square,u):"move"===c.type&&er(c.source,c.destination,c.piece,u):e("#"+F[c.square]).append(Z(c.piece,!0)).find("."+o.piece).fadeIn($.appearSpeed,u)}function u(){(s+=1)===t.length&&(ea(),d($.onMoveEnd)&&$.onMoveEnd(p(a),p(n)))}}(function e(r,t){r=p(r),t=p(t);var a=[],n={};for(var o in t)t.hasOwnProperty(o)&&r.hasOwnProperty(o)&&r[o]===t[o]&&(delete r[o],delete t[o]);for(o in t)if(t.hasOwnProperty(o)){var s=O(r,t[o],o);s&&(a.push({type:"move",source:s,destination:o,piece:t[o]}),delete r[s],delete t[o],n[o]=!0)}for(o in t)t.hasOwnProperty(o)&&(a.push({type:"add",square:o,piece:t[o]}),delete t[o]);for(o in r)r.hasOwnProperty(o)&&(n.hasOwnProperty(o)||(a.push({type:"clear",square:o,piece:r[o]}),delete r[o]));return a}(I,r),I,r),eo(r)):(eo(r),ea())},M.resize=function(){H=function e(){var r=parseInt(N.width(),10);if(!r||r<=0)return 0;for(var t=r-1;t%8!=0&&t>0;)t-=1;return t/8}(),K.css("width",8*H+"px"),j.css({height:H,width:H}),$.sparePieces&&N.find("."+o.sparePieces).css("paddingLeft",H+X+"px"),en()},M.start=function(e){M.position("start",e)};var ed=s(function e(r){W&&eu(r.pageX,r.pageY)},$.dragThrottleRate),eh=s(function e(r){W&&(r.preventDefault(),eu(r.originalEvent.changedTouches[0].pageX,r.originalEvent.changedTouches[0].pageY))},$.dragThrottleRate);return Y=$.orientation,$.hasOwnProperty("position")&&("start"===$.position?I=p(n):P($.position)?I=m($.position):b($.position)?I=p($.position):J(7263,"Invalid value passed to config.position.",$.position)),function e(){for(var t=0;t<r.length;t++)for(var a=1;a<=8;a++){var n=r[t]+a;F[n]=n+"-"+i()}var o="KQRNBP".split("");for(t=0;t<o.length;t++){var s="w"+o[t],p="b"+o[t];A[s]=s+"-"+i(),A[p]=p+"-"+i()}}(),N.html((B=$.sparePieces,C='<div class="{chessboard}">',B&&(C+='<div class="{sparePieces} {sparePiecesTop}"></div>'),C+='<div class="{board}"></div>',B&&(C+='<div class="{sparePieces} {sparePiecesBottom}"></div>'),u(C+="</div>",o))),K=N.find("."+o.board),$.sparePieces&&(D=N.find("."+o.sparePiecesTop),Q=N.find("."+o.sparePiecesBottom)),E=i(),e("body").append(Z("wP",!0,E)),j=e("#"+E),X=parseInt(K.css("borderLeftWidth"),10),M.resize(),e("body").on("mousedown mousemove","."+o.piece,function e(r){r.preventDefault()}),K.on("mousedown","."+o.square,function r(t){if($.draggable&&3!=t.which){var a=e(this).attr("data-square");v(a)&&I.hasOwnProperty(a)&&ec(a,I[a],t.pageX,t.pageY)}}),N.on("mousedown","."+o.sparePieces+" ."+o.piece,function r(t){$.sparePieces&&ec("spare",e(this).attr("data-piece"),t.pageX,t.pageY)}),K.on("mouseenter","."+o.square,function r(t){if(!W&&d($.onMouseoverSquare)){var a=e(t.currentTarget).attr("data-square");if(v(a)){var n=!1;I.hasOwnProperty(a)&&(n=I[a]),$.onMouseoverSquare(a,n,p(I),Y)}}}).on("mouseleave","."+o.square,function r(t){if(!W&&d($.onMouseoutSquare)){var a=e(t.currentTarget).attr("data-square");if(v(a)){var n=!1;I.hasOwnProperty(a)&&(n=I[a]),$.onMouseoutSquare(a,n,p(I),Y)}}}),(R=e(window)).on("mousemove",ed).on("mouseup",function e(r){W&&ef(es(r.pageX,r.pageY))}),"ontouchstart"in document.documentElement&&(K.on("touchstart","."+o.square,function r(t){if($.draggable){var a=e(this).attr("data-square");v(a)&&I.hasOwnProperty(a)&&(t=t.originalEvent,ec(a,I[a],t.changedTouches[0].pageX,t.changedTouches[0].pageY))}}),N.on("touchstart","."+o.sparePieces+" ."+o.piece,function r(t){if($.sparePieces){var a;ec("spare",e(this).attr("data-piece"),(t=t.originalEvent).changedTouches[0].pageX,t.changedTouches[0].pageY)}}),R.on("touchmove",eh).on("touchend",function e(r){W&&ef(es(r.originalEvent.changedTouches[0].pageX,r.originalEvent.changedTouches[0].pageY))})),M},window.ChessBoard=window.Chessboard,window.Chessboard.fenToObj=m,window.Chessboard.objToFen=y}(),"undefined"!=typeof exports&&(exports.Chessboard=window.Chessboard);